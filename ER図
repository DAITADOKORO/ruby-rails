ER図

エンティティ
  実体（登場人物やもの、概念など）
  管理すべきデータの塊
  人・物・建物　ーー　物理的なもの
  企業・税・取引履歴　ーー　概念的なもの

アトリビュート
  属性（エンティティの追加情報）

リレーション
  エンティティ同士の関連性

カーディナリティー
  エンティティ間の多重度



１、エンティティの洗い出し

システム利用における一連の流れを可視化。会員のオペレーションの流れを図示すると良い。
この時の登場人物や行為が「エンティティ」

ここからツールを使ってER図を作成していく。
今回は「draw.io」を使用。
new - basic - blankdiagram - create
entity relation でtableをドラッグ＆ドロップ
上部に「エンティティ名」を入れていき、どんどん量産。

２、要件から属性を抜き出す
属性は、「付加情報」
それぞれのエンティティに関係のありそうな属性を、要件から抜き出していく。

railsでモデルを作成した際にデフォルトで作成されるカラムも記述。
  id(主キー) 登録日　更新日


３、重複するものは分割する
商品など、いくつ、何種類買うかわからないものは一つのエンティティの中に繰り返し出現する可能性がある。これが重複するものとなる。
こういった属性は、別のエンティティとして切り出す。
しかし、切り出しただけだと、「注文商品」がどの「注文」に紐付けられているかわからない。

よって、外部キーが必要となる。
自分（子エンティティ）が所属する大元のデータ（親エンティティ）の主キーを持つ。


４、外部キーで置き換える
「会員氏名」という属性は、同姓同名だったり、姓が変わることがあり、どのレコードを書き換えたらいいかわからないといった事態が発生しうる。
こいつは別エンティティの主キー（外部キー）で置き換えてしまえ。


５、マスタ項目を分割する
商品のジャンルを考えた時、リリース後にジャンルの追加や変更をすると少し厄介なことになる。
修正漏れ、誤修正、表記揺れなど、様々なミスが想定されるからだ。
ジャンルに新しいカテゴリを追加しても、テーブルに追加せず存在を把握てできないケースも考慮される。

これらのトラブルを防ぐべく、マスタテーブルを作成する。

・マスタテーブルとは
  サイトの会員など、顧客のアクションでデータが増えることはないテーブル。更新は頻繁に起こらない。

・トランザクションテーブル（マスタテーブルの対）
  顧客起因でデータが蓄積されるようなテーブル（注文情報など）
  取引のたびにデータが増加していく。

ジャンル（マスタとなるエンティティ）は切り分けてしまえ。

６、多重度を考える
多重度とは、二つのエンティティ間の、「片方のエンティティから見て、相手のエンティティはいくつあるか」を表すもの。

１：１　１：N N:N っつー例のやつ。

draw.ioでは、Lineでエンティティ同士をつなぎ、カーディナリティを設定する。

１対１のリレーションは、テーブルをまとめることができるから基本的に作る必要なし。

多対多は、一つのカラムにカンマ区切り（繰り返し）が出現することや、繰り返し項目を排除すると同じ項目が並んでしまうといったNGが飛び出てくる。

そこで、中間テーブルというものを作って回避する。




テーブル定義書

テーブルやカラムの定義や制約を定める設計書
railsでは、migrationファイルの材料となる、非常に重要なドキュメント

ER図で洗い出したエンティティ・属性について、テーブル定義書にまとめていく。



DB設計は特に難しいが、経験を積むにつれ感覚的にできるようになっていく。
身の回りの事柄について「どんなデータの持ち方をしているのかな？」と考える癖を身につけるとスムーズに上達できるかも！


ボトムアップアプローチ
既存の画面や帳票から要素を洗い出す方法。
直近のユーザニーズを的確に反映することができる。

トップダウンアプローチ
要件などからER図などで表される概念データモデルを作成し、具体化を進める方法。
将来的な拡張性を考慮した設計を行うことができる


複合主キー
データベースのキー
データを一位に識別するための項目
二つ以上の項目を見ることで一位に識別できる。

主キー（データの出席番号として使われる項目、データを一意に特定するための項目）の分類の一つであり、
複数の項目がワンセットになることで１つの主キーとしての役割を果たす主キーのこと。

例）
  出席番号が男女別に割り振られるタイプの分け方。
  出席番号プラス性別とすることでデータを特定できる。





複数の外来診療かあり
院内薬局で処方箋。期限あり。処方箋発行の際、薬剤併用チェックを行う。
併用を禁止する”併用禁忌”となる薬剤の組み合わせ




